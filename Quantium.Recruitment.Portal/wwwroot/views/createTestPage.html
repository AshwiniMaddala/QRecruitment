<md-toolbar>
    <div class="md-toolbar-tools">
        <md-button hide-gt-sm class="md-icon-button" ng-click="toggleSidenav()">
            <md-icon md-svg-icon="menu"></md-icon>
        </md-button>
        <h1 class="justify-self-center">
            Tests
        </h1>
    </div>
</md-toolbar>
<div ng-include="'../views/settingsFab.html'"></div>
<md-content class="fill-height">
    <md-tabs class="fill-height">
        <md-tab label="Create test" class="fill">
            <md-tab-content layout="column">
                <form name="createTestForm">
                    <md-card>
                        <md-card-content layout="column">
                            <div layout="row">
                                <md-input-container flex-gt-sm="30">
                                    <label>Job</label>
                                    <md-select ng-model="selectedJobId" required name="selectedJobName">
                                        <md-option ng-repeat="job in jobs" ng-value="job.Id" ng-click="changeSelectedJob(job)">
                                            {{job.Title}}
                                        </md-option>
                                    </md-select>
                                    <div ng-messages="createTestForm.selectedJobName.$error">
                                        <div ng-message="required">Job is required.</div>
                                    </div>
                                </md-input-container>
                            </div>

                            <div ng-hide="selectedJobId == 0">
                                <div layout="row">
                                    <div flex-gt-sm="35">
                                        <h4 ng-show="totalQuestionsInSelectedJob">Total questions in selected job: {{totalQuestionsInSelectedJob}}</h4>
                                        <h4 ng-show="totalCorrectAnswersInSelectedJob">Total right answers to pass the test: {{totalCorrectAnswersInSelectedJob}}</h4>
                                    </div>
                                    <div flex-gt-sm="50">
                                        <div>
                                            <div ng-repeat="jobDifficultyLabel in selectedJob.JobDifficultyLabels">
                                                <md-chips>
                                                    <md-chip>{{jobDifficultyLabel.Label.Name}}</md-chip>
                                                    <md-chip>Difficulty - {{jobDifficultyLabel.Difficulty.Name}}</md-chip>
                                                    <md-chip>Questions - {{jobDifficultyLabel.DisplayQuestionCount}}</md-chip>
                                                    <md-chip>Passing criteria - {{jobDifficultyLabel.PassingQuestionCount}}</md-chip>
                                                </md-chips>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </md-card-content>
                    </md-card>

                    <md-card>
                        <md-card-content>
                            <div layout="row">
                                <h3 class="fileUpload">Select the candidates for this job</h3>
                            </div>
                            <div layout="row">
                                <md-input-container flex-gt-sm="30" class="searchCandidates">
                                    <md-icon md-svg-src="../img/search.svg" class="email"></md-icon>
                                    <input ng-model="search" type="text" placeholder="Search Candidates" class="clearXinIE">
                                </md-input-container>

                                <md-input-container class="selectAllCandidates">
                                    <md-checkbox ng-model="selectedAll" ng-change="checkAll(filteredCandidates)"> Select All</md-checkbox>
                                </md-input-container>
                            </div>
                            <div layout="row" layout-wrap>
                                <div ng-repeat="candidate in (filteredCandidates = (candidates | filter:search))">
                                    <md-card>
                                        <md-card-content>
                                            <md-input-container>
                                                <md-checkbox ng-model="selectedtestOptions.candidateIds[candidate.Id]">
                                                    {{candidate.FirstName}} {{candidate.LastName}}
                                                </md-checkbox>
                                                <h4>{{candidate.Email}}</h4>
                                            </md-input-container>
                                        </md-card-content>
                                    </md-card>
                                </div>
                            </div>

                            <br />
                            <br />
                            <br />
                            <md-button ng-disabled="!hasSelectedAtleastOneCandidate" type="submit" class="md-primary md-raised" ng-click="createTestForm.$valid && generateTest()">
                                Generate test for selected candidates
                            </md-button>
                            <!--<div class="_md-right" ng-show="testGenerationResult">
                    <md-button class="md-primary md-raised" ng-click="sendTest()">
                        Send test for selected candidates
                    </md-button>
                </div>-->
                        </md-card-content>
                    </md-card>
                </form>
            </md-tab-content>
        </md-tab>
        <md-tab label="View tests">
            <md-tab-content>
                <div layout="row">
                    <md-card ng-repeat="test in allTests" layout="row" layout-wrap >
                        <md-card-title>
                            <md-card-title-text>
                                <span class="md-headline">Job : {{test.Job.Title}}</span>
                            </md-card-title-text>
                        </md-card-title>
                        <md-card-content>
                            
                            <div>
                                <h4></h4>
                                <h4>Candidate name : {{test.Candidate.FirstName}} {{test.Candidate.LastName}}</h4>
                                <h4>Candidate email : {{test.Candidate.Email}}</h4>
                                <h4><b>Test status : {{test.IsFinished ? "Completed" : "Pending"}}</b></h4>
                            </div>
                            
                        </md-card-content>
                    </md-card>
                </div>
            </md-tab-content>
        </md-tab>
    </md-tabs>
    
</md-content>

<div style="visibility: hidden">
    <div class="md-dialog-container" id="uploadStatusModal">
        <md-dialog>
            <md-progress-circular md-mode="indeterminate" class="md-primary justify-self-center"></md-progress-circular>
        </md-dialog>
    </div>
</div>